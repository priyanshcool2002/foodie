<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Foodie - Cart</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
</head>

<body>
  <!-- Navbar (same as other pages, include dynamic cartCount) -->

  <div class="container my-5">
    <h2 class="mb-4">Your Cart</h2>
    <div id="cartContainer" class="table-responsive"></div>

    <!-- Totals -->
    <div class="text-end mt-3">
      <p class="mb-1">Items Total: ₹<span id="itemsTotal">0</span></p>
      <p class="mb-1">Delivery Charge: ₹<span id="deliveryCharge">0</span></p>
      <h4 class="fw-bold">Grand Total: ₹<span id="grandTotal">0</span></h4>
      <button class="btn btn-primary mt-3" onclick="checkout()">Checkout</button>
    </div>
  </div>

  <script>
    const DELIVERY_CHARGE = 50; // flat delivery charge

    function renderCart() {
      const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
      const cartContainer = document.getElementById("cartContainer");
      const itemsTotalEl = document.getElementById("itemsTotal");
      const deliveryChargeEl = document.getElementById("deliveryCharge");
      const grandTotalEl = document.getElementById("grandTotal");

      if (cartItems.length === 0) {
        cartContainer.innerHTML = `<p>Your cart is empty.</p>`;
        itemsTotalEl.textContent = "0";
        deliveryChargeEl.textContent = "0";
        grandTotalEl.textContent = "0";
        return;
      }

      let html = `<table class="table table-bordered">
                    <thead>
                      <tr>
                        <th>Item</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Subtotal</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>`;

      let itemsTotal = 0;
      cartItems.forEach((item, index) => {
        const subtotal = item.price * item.quantity;
        itemsTotal += subtotal;

        html += `<tr>
                  <td>${item.name}</td>
                  <td>₹${item.price}</td>
                  <td>${item.quantity}</td>
                  <td>₹${subtotal}</td>
                  <td><button class="btn btn-danger btn-sm" onclick="removeItem(${index})">Remove</button></td>
                </tr>`;
      });

      html += `</tbody></table>`;
      cartContainer.innerHTML = html;

      // update totals
      itemsTotalEl.textContent = itemsTotal;
      deliveryChargeEl.textContent = DELIVERY_CHARGE;
      grandTotalEl.textContent = itemsTotal + DELIVERY_CHARGE;
    }

    function removeItem(index) {
      let cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
      cartItems.splice(index, 1);
      localStorage.setItem("cartItems", JSON.stringify(cartItems));
      renderCart();
      updateCartCount();
    }

    function checkout() {
      const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
      if (cartItems.length === 0) {
        alert("Your cart is empty!");
        return;
      }

      alert("Thank you! Your order has been placed.");
      localStorage.removeItem("cartItems");
      renderCart();
      updateCartCount();
    }

    function updateCartCount() {
      const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
      const cartCount = document.getElementById('cartCount');
      if (cartCount) {
        cartCount.textContent = cartItems.reduce((total, item) => total + item.quantity, 0);
      }
    }

    window.onload = function () {
      renderCart();
      updateCartCount();
    }
  </script>
</body>
</html>
